FROM tomcat:10.1-jre25-temurin

# 1) Tomcat default apps 제거
RUN rm -rf /usr/local/tomcat/webapps/*

# 2) 같은 Pod 안에서 Nginx가 8080을 쓰므로 Tomcat은 8081로 변경
RUN sed -i 's/port="8080"/port="8081"/g' /usr/local/tomcat/conf/server.xml

# 3) WAR 배포 (ROOT 컨텍스트)
COPY target/blog.war /usr/local/tomcat/webapps/ROOT.war

# (옵션) 헬스체크
HEALTHCHECK --interval=30s --timeout=3s --start-period=20s --retries=3 \
  CMD curl -fsS http://127.0.0.1:8081/ || exit 1
