# vi loop2.yaml
hosts: localhost
  tasks:
  - name: add users
    user:
      name: "{{ item.name }}"
      state: present
      groups: "{{ item.groups }}"
    loop:
      - { name: 'admuser', groups: 'wheel' }
      - { name: 'normaluser', groups: 'adm' }
  - name: add users
    user:
      name: "{{ item.username }}"
      state: present
      groups: "{{ item.groups }}"
    loop: "{{ user_data | dict2items }}"
    vars:
      user_data:
        username: toor
        groups: wheel
  - name: register with loop
    shell: "echo {{ item }}"
    loop:
      - "one"
      - "two"
    register: echo 
  - name: dumped the echo register
    debug:
      msg: "{{ echo }}"
  - name: Fail if return code is not 0
    fail:
      msg: "The command ({{ item.cmd }}) is not return 0"
    when: item.rc != 0
    loop: "{{ echo.results }}"
  - name: In loop and looping the result
    file:
      path: "/tmp/{{ item }}"
      state: touch
    loop:
      - one
      - two
  - name: mysql user access
    mariadb_user:
      name: "{{ item[0] }}"
      priv: "{{ item[1] }}.*:ALL"
      append_privs: yes
      password: "marriadb"
    loop: - "{{ ['user1', 'user2' ] | product(['sample_db1', 'sample_db2', 'sample_db3']) | list }}"
